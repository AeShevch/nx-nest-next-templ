.PHONY: proto build run clean install-deps

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è proto —Ñ–∞–π–ª–æ–≤
proto:
	@echo "üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Go –∫–æ–¥–∞ –∏–∑ proto —Ñ–∞–π–ª–æ–≤..."
	@./generate-proto.sh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
install-deps:
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	@go mod tidy
	@go mod download

# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
build: proto
	@echo "üî® –°–±–æ—Ä–∫–∞ Order Service..."
	@go build -o bin/order-service cmd/server/main.go

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
run: build
	@echo "üöÄ –ó–∞–ø—É—Å–∫ Order Service –Ω–∞ –ø–æ—Ä—Ç—É 5003..."
	@./bin/order-service

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
dev: proto
	@echo "üîß –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
	@go run cmd/server/main.go

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	@rm -rf bin/
	@rm -rf proto/*.pb.go

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
test:
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	@go test ./...

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
fmt:
	@echo "‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
	@go fmt ./...

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
lint:
	@echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞..."
	@go vet ./...

# –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
all: clean fmt lint proto build test
	@echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!" 